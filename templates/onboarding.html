<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personaliza a Lina | Hotel Aramé</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.css">
    <style>
        :root {
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --primary-color: #666666;
            --accent-color: #6b7280;
            --btn-color: #4b5563;
            --btn-hover: #374151;
            --btn-text: #ffffff;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }
        
        .card-title {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .onboarding-steps {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 16px;
        }
        
        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--border-color);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 600;
        }
        
        .step.active .step-number, .step.completed .step-number {
            background-color: var(--accent-color);
            color: white;
        }
        
        .step-title {
            font-size: 14px;
            color: var(--primary-color);
        }
        
        .step.active .step-title, .step.completed .step-title {
            color: var(--text-color);
            font-weight: 500;
        }
        
        .step-connector {
            position: absolute;
            height: 3px;
            background-color: var(--border-color);
            width: 100%;
            top: 16px;
            left: 50%;
            z-index: -1;
        }
        
        .step.completed .step-connector {
            background-color: var(--accent-color);
        }
        
        /* Form styles */
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-select, .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: white;
            color: var(--text-color);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
        }
        
        .form-select:focus, .form-input:focus {
            border-color: var(--accent-color);
            outline: none;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s, transform 0.2s;
        }
        
        .btn-back {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
        
        .btn-next, .btn-submit {
            background-color: var(--btn-color);
            color: var(--btn-text);
        }
        
        .btn-next:hover, .btn-submit:hover {
            background-color: var(--btn-hover);
            transform: translateY(-1px);
        }
        
        .btn-skip {
            background-color: transparent;
            border: none;
            color: var(--primary-color);
            text-decoration: underline;
            padding: 12px;
            cursor: pointer;
        }
        
        /* Welcome screen */
        .welcome-section {
            text-align: center;
            padding: 20px 0;
        }
        
        .welcome-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 20px;
            display: block;
            border: 3px solid var(--accent-color);
        }
        
        .welcome-title {
            font-size: 24px;
            margin-bottom: 16px;
        }
        
        .welcome-text {
            color: var(--primary-color);
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        /* Completion screen */
        .completion-section {
            text-align: center;
            padding: 20px 0;
        }
        
        .completion-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #f0fdf4;
            color: #22c55e;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .completion-title {
            font-size: 24px;
            margin-bottom: 16px;
        }
        
        .completion-text {
            color: var(--primary-color);
            margin-bottom: 30px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Personaliza tu experiencia con Lina</h1>
            </div>
            
            <div class="card-body">
                <div class="onboarding-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-title">Bienvenida</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-title">Viaje</div>
                        <div class="step-connector"></div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-title">Intereses</div>
                        <div class="step-connector"></div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-title">Preferencias</div>
                        <div class="step-connector"></div>
                    </div>
                    <div class="step" data-step="5">
                        <div class="step-number">5</div>
                        <div class="step-title">Completado</div>
                        <div class="step-connector"></div>
                    </div>
                </div>
                
                <form id="preferences-form">
                    <input type="hidden" id="guest-id" value="{{ guest.id }}">
                    
                    <!-- Step 1: Welcome -->
                    <div class="form-step active" data-step="1">
                        <div class="welcome-section">
                            <img src="https://images.unsplash.com/photo-1594751684241-bcef6f2a6d27?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8Y29uY2llcmdlfGVufDB8fDB8fHww&auto=format&fit=crop&w=150&q=80" class="welcome-image" alt="Lina">
                            <h2 class="welcome-title">¡Hola, {{ guest.name }}!</h2>
                            <p class="welcome-text">Soy Lina, tu asistente personal durante tu estadía en el Hotel Aramé. Para ofrecerte las mejores recomendaciones, me gustaría conocer un poco más sobre tus preferencias. Esto solo tomará un minuto.</p>
                        </div>
                        
                        <div class="form-actions">
                            <a href="{{ url_for('chat', guest_id=guest.id) }}" class="btn-skip">Omitir personalización</a>
                            <button type="button" class="btn btn-next" data-next="2">Comenzar</button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Trip Type -->
                    <div class="form-step" data-step="2">
                        <div class="form-group">
                            <label class="form-label">¿Cuál es el motivo principal de tu viaje a Medellín?</label>
                            <select class="form-select" id="trip-type">
                                <option value="">Selecciona una opción</option>
                                <option value="business">Negocios</option>
                                <option value="leisure">Vacaciones</option>
                                <option value="family">Viaje familiar</option>
                                <option value="couple">Viaje en pareja</option>
                                <option value="solo">Viaje solo</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-back" data-back="1">Atrás</button>
                            <button type="button" class="btn btn-next" data-next="3">Siguiente</button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Interests -->
                    <div class="form-step" data-step="3">
                        <div class="form-group">
                            <label class="form-label">¿Qué te interesa descubrir en Medellín? (selecciona todas las que apliquen)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-gastronomy" value="gastronomy">
                                    <label for="interest-gastronomy">Gastronomía</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-culture" value="culture">
                                    <label for="interest-culture">Arte y Cultura</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-adventure" value="adventure">
                                    <label for="interest-adventure">Aventura</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-nature" value="nature">
                                    <label for="interest-nature">Naturaleza</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-shopping" value="shopping">
                                    <label for="interest-shopping">Compras</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-nightlife" value="nightlife">
                                    <label for="interest-nightlife">Vida Nocturna</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-sports" value="sports">
                                    <label for="interest-sports">Deportes</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="interest-history" value="history">
                                    <label for="interest-history">Historia</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-back" data-back="2">Atrás</button>
                            <button type="button" class="btn btn-next" data-next="4">Siguiente</button>
                        </div>
                    </div>
                    
                    <!-- Step 4: Preferences -->
                    <div class="form-step" data-step="4">
                        <div class="form-group">
                            <label class="form-label">Preferencias alimentarias</label>
                            <select class="form-select" id="diet-preference">
                                <option value="">Sin preferencias específicas</option>
                                <option value="vegetarian">Vegetariano</option>
                                <option value="vegan">Vegano</option>
                                <option value="gluten-free">Sin gluten</option>
                                <option value="lactose-free">Sin lactosa</option>
                                <option value="kosher">Kosher</option>
                                <option value="halal">Halal</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Transporte preferido</label>
                            <select class="form-select" id="transport-preference">
                                <option value="taxi">Taxi</option>
                                <option value="private">Auto privado</option>
                                <option value="luxury">Auto de lujo</option>
                                <option value="public">Transporte público</option>
                            </select>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-back" data-back="3">Atrás</button>
                            <button type="button" class="btn btn-next" data-next="5">Finalizar</button>
                        </div>
                    </div>
                    
                    <!-- Step 5: Completion -->
                    <div class="form-step" data-step="5">
                        <div class="completion-section">
                            <div class="completion-icon">
                                <i data-feather="check"></i>
                            </div>
                            <h2 class="completion-title">¡Todo listo!</h2>
                            <p class="completion-text">Gracias por compartir tus preferencias. Ahora podré ofrecerte recomendaciones más personalizadas durante tu estadía en el Hotel Aramé.</p>
                        </div>
                        
                        <div class="form-actions" style="justify-content: center;">
                            <button type="button" id="start-chat" class="btn btn-submit">Comenzar a chatear</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Feather icons
            feather.replace();
            
            const guestId = document.getElementById('guest-id').value;
            const form = document.getElementById('preferences-form');
            const steps = document.querySelectorAll('.form-step');
            const stepIndicators = document.querySelectorAll('.onboarding-steps .step');
            
            // Next button functionality
            document.querySelectorAll('.btn-next').forEach(button => {
                button.addEventListener('click', () => {
                    const currentStep = parseInt(button.closest('.form-step').dataset.step);
                    const nextStep = parseInt(button.dataset.next);
                    
                    // Hide current step, show next step
                    document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
                    document.querySelector(`.form-step[data-step="${nextStep}"]`).classList.add('active');
                    
                    // Update step indicators
                    stepIndicators.forEach(indicator => {
                        const stepNum = parseInt(indicator.dataset.step);
                        if (stepNum < nextStep) {
                            indicator.classList.remove('active');
                            indicator.classList.add('completed');
                        } else if (stepNum === nextStep) {
                            indicator.classList.add('active');
                        } else {
                            indicator.classList.remove('active', 'completed');
                        }
                    });
                });
            });
            
            // Back button functionality
            document.querySelectorAll('.btn-back').forEach(button => {
                button.addEventListener('click', () => {
                    const currentStep = parseInt(button.closest('.form-step').dataset.step);
                    const prevStep = parseInt(button.dataset.back);
                    
                    // Hide current step, show previous step
                    document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
                    document.querySelector(`.form-step[data-step="${prevStep}"]`).classList.add('active');
                    
                    // Update step indicators
                    stepIndicators.forEach(indicator => {
                        const stepNum = parseInt(indicator.dataset.step);
                        if (stepNum < prevStep) {
                            indicator.classList.remove('active');
                            indicator.classList.add('completed');
                        } else if (stepNum === prevStep) {
                            indicator.classList.add('active');
                            indicator.classList.remove('completed');
                        } else {
                            indicator.classList.remove('active', 'completed');
                        }
                    });
                });
            });
            
            // Submit button functionality
            document.getElementById('start-chat').addEventListener('click', async () => {
                // Collect all form data
                const tripType = document.getElementById('trip-type').value;
                
                // Collect interests
                const interests = [];
                document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                    interests.push(checkbox.value);
                });
                
                const diet = document.getElementById('diet-preference').value;
                const transport = document.getElementById('transport-preference').value;
                
                // Prepare data for API
                const preferenceData = {
                    guest_id: guestId,
                    trip_type: tripType,
                    interests: interests,
                    diet: diet,
                    transport: transport
                };
                
                try {
                    // Submit preferences
                    const response = await axios.post('/api/save-preferences', preferenceData);
                    
                    if (response.data.success) {
                        // Redirect to chat
                        window.location.href = response.data.chat_url;
                    }
                } catch (error) {
                    console.error('Error saving preferences:', error);
                    alert('Hubo un problema al guardar tus preferencias. Serás redirigido al chat.');
                    window.location.href = `/chat/${guestId}`;
                }
            });
        });
    </script>
</body>
</html>